services:
  - type: web
    name: next-flask-app
    runtime: node
    buildCommand: |
      apt-get update && 
      apt-get install -y --no-install-recommends openjdk-17-jre && 
      python -m venv venv && 
      . venv/bin/activate && 
      pip install --upgrade pip && 
      pip install -r api/requirements.txt && 
      npm install && 
      npm run build
    startCommand: . venv/bin/activate && npm run start-production
    envVars:
      - key: NODE_ENV
        value: production
      - key: FLASK_PORT
        value: "5328"
      - key: NEXT_PUBLIC_API_URL
        value: "/api"
      - key: JAVA_HOME
        value: "/usr/lib/jvm/java-17-openjdk-amd64"